kind: pipeline
name: train
type: docker

concurrency:
  limit: 1

steps:
  - name: install
    image: pytorch/pytorch:latest
    privileged: true
    shm_size: 1073741824
    environment:
      mount_command:
        from_secret: mount_command
      PYTHONPATH: /workspace/
      DATA_DIR: /workspace/data/
    commands:
      - python -m pip install -q -U pip
      - pip install -q torchsummary matplotlib pytorch-metric-learning torchinfo torch torchvision tqdm Pillow facenet-pytorch
      - apt update -qq
      - apt install fonts-noto-cjk-extra -y -qq
      - ls ./
      - mkdir -p data
      - $mount_command
      - ls data/
      - CI=True python finetune/facenet_transfer_learning.py